# TTS Sound Effects (tts_fx)

A Home Assistant add-on that applies customizable sound effects to text-to-speech (TTS) audio generated by the Piper TTS engine.  
Filters can be applied using SoX (Sound eXchange), with support for mixing background noise or other audio effects.

---

## Features

- Generates TTS audio via the Piper (Wyoming) TTS engine.
- Applies a configurable SoX filter chain to modify voice pitch, add reverb, and more.
- Mixes processed audio with background noise (e.g., brown noise) for ambient effects.
- Configurable via environment variables to customize voice, output format, and SoX filters.
- Exposes a REST API endpoint `/speak` for generating processed TTS audio.

---

## Usage

### API

POST `/speak`

Request JSON:

{
  "message": "Text to be spoken",
  "uuid": "optional-unique-id-for-filename",
  "voice": "optional-voice-name"
}

Response JSON:

{
  "status": "ok",
  "output": "/media/tts_fx/output_*uuid*.mp3",
  "duration": 4.2
}

---

## Configuration

### Environment Variables

- `PIPER_HOST` (default: `core-piper`): Hostname or IP of the Piper TTS server.
- `PIPER_PORT` (default: `10200`): Port of the Piper TTS server.
- `PIPER_VOICE` (default: `None`): Default voice name for TTS synthesis (if omitted, Piperâ€™s default voice is used).
- `OUT_TYPE` (default: `mp3`): Output audio file format (e.g., mp3, wav).
- `TTS_FILTERS` (default: empty): Space-separated SoX effect chain applied to the TTS audio.
- `BACKGROUND_FILTERS` (default: empty): Space-separated SoX effect chain applied when generating background audio (e.g., noise).

### Example "Apollo" Filter Settings

To apply the classic "Apollo" effect chain as used in previous versions, set the environment variables as follows:

TTS_FILTERS="pitch -300 highpass 300 lowpass 3000 compand 0.3,1 6:-70,-60,-20 -5 -90 0.2 reverb 50 50 100 100 0 2 overdrive 10 gain -n -3"

BACKGROUND_FILTERS="brownnoise vol 0.08"

---

## File Storage

- Input raw TTS files and output processed audio are stored in `/media/tts_fx/` inside the container.
- Files are automatically cleaned up after processing.

---

## Running the Add-on

The add-on runs a Flask web server listening on port 10300.  
Send HTTP POST requests to `/speak` with your text and optional parameters to generate processed TTS audio.

---

## License

Licensed under the Apache License 2.0. See the LICENSE file for details.

---

## Disclaimer

This software requires Piper TTS engine running and SoX installed.  
Filter chains can be customized but improper settings might cause unexpected audio artifacts.

---

## Contributions

Contributions, suggestions, and bug reports are welcome via the GitHub repository.

---

## Contact

For support or questions, please open an issue in the GitHub repo or contact the maintainer.
